# ğŸ“¦ Disaffected â€” Show Builder System

This is the core rundown management system used in the *Disaffected* media automation environment. It provides a full-stack interface for organizing, reordering, and saving show segments in coordination with markdown-based editorial workflows (e.g., Obsidian).

---

## ğŸ“š Table of Contents

* [ğŸ§  Overview](#-overview)
* [ğŸ” Frontendâ€“Backend Interaction](#-frontendâ€“backend-interaction)
* [ğŸ–¥ï¸ How to Launch](#ï¸-how-to-launch)
* [ğŸ“‚ Obsidian Integration](#-obsidian-integration)
* [ğŸš€ Recent Update (Changelog)](#-recent-update-changelog--v100)
* [ğŸ‘‰ Still Needed](#-still-needed)
* [ğŸ—¯ Git & Commit Workflow](#-git--commit-workflow)
* [ğŸ Summary](#-summary)

---

## ğŸ§  Overview

The system is composed of two primary components:

### 1. **Frontend â€” `disaffected-ui`**

* Built with **Vue 3**, **Vuetify 3**, and **vuedraggable**
* Loads markdown segment metadata from the backend
* Provides a drag-and-drop UI to reorder segments
* Sends reordered segment lists to backend for persistent saving

### 2. **Backend â€” `show-build-server`**

* Built with **FastAPI**
* Runs in Docker using `tiangolo/uvicorn-gunicorn-fastapi:python3.11`
* Handles:

  * Serving segment metadata from Obsidian-managed markdown files
  * Accepting reordered lists and writing `order:` metadata to YAML frontmatter
  * Generating asset IDs and preprocessing SOT files via MQTT

---

## ğŸ” Frontendâ€“Backend Interaction

| Action            | Flow                                                                   |
| ----------------- | ---------------------------------------------------------------------- |
| Load Segment List | `GET /rundown/{episode}` â€” frontend fetches list of `.md` files        |
| Reorder Segments  | `POST /rundown/{episode}/reorder` â€” frontend sends reordered filenames |
| Save to Disk      | Backend parses each file, assigns `order: 10, 20, 30...`, and saves    |

The markdown files are stored in `/mnt/sync/disaffected/episodes/{episode}/rundown`, mounted into the Docker container at `/home/episodes`.

---

## ğŸ–¥ï¸ How to Launch

### âœ… Backend (FastAPI)

From `/mnt/process/show-build/`:

```bash
docker compose up --build
```

The container is named `show-build-server`. Ports:

* `80` in container
* Mapped to `8888` on host (`http://192.168.51.210:8888`)

### âœ… Frontend (Vue)

From `/mnt/process/show-build/disaffected-ui`:

```bash
npm install
npm run serve
```

This runs on default port `8080` unless overridden.

---

## ğŸ“‚ Obsidian Integration

* All segment `.md` files are authored and managed in Obsidian.
* Reordering in the UI modifies the `order:` field in frontmatter.
* Filenames are not renamed, preserving link stability.
* Segment sorting is done based on the `order:` field (not filename prefix).

---

## ğŸš€ Recent Update (Changelog â€” v1.0.0)

**ğŸŸ¢ New:**

* Drag-and-drop ordering of segment cards
* Save Order button commits changes to backend
* FastAPI route `/rundown/{episode}/reorder` implemented
* Writes `order:` field in YAML frontmatter in steps of 10
* Group permission fix: Docker user `insider` can write to `/home/episodes`

**ğŸ”§ Infra:**

* Fixed Docker `USER` and `groupadd` conflicts
* `frontmatter` added to `requirements.txt`
* Axios POST debugged and corrected for CORS + port 8888

**âœ… Verified:**

* End-to-end working from UI to filesystem

---

## ğŸ‘‰ Still Needed

### ğŸ“¦ Frontend Dockerization

* Currently launched manually via `npm run serve`
* Needs a production-ready build (`npm run build`) and Docker container
* Add NGINX or serve static files via FastAPI if needed

### ğŸª™ UI Enhancements

* Show `asset_id` in each segment card
* Add inline editing of metadata (`title`, `slug`, etc.)
* Confirmation toasts/snackbar for success/failure
* Episode selector component to load different folders

### ğŸ›  Backend Enhancements

* Add endpoint to edit metadata fields (`PUT /rundown/{episode}/{filename}`)
* Validate frontmatter schema
* Add logging to file for traceability

### ğŸ” QA Tasks

* Test with segments across multiple blocks (100s, 200s, 300s)
* Confirm Obsidian plugin compatibility with `order:` sorting
* Write tests for empty or malformed `.md` files

---

## ğŸ—¯ Git & Commit Workflow

### âœ… Basic Usage

```bash
git init
git add .
git commit -m "Initial working version of Show Builder"
git branch -M main
git remote add origin git@github.com:youruser/show-build.git
git push -u origin main
```

### âœ… Exclude Unnecessary Files

Make sure `.gitignore` includes:

```gitignore
disaffected-ui/node_modules/
disaffected-ui/dist/
*.log
*.bak
__pycache__/
*.pyc
```

### âš ï¸ Note on `node_modules`

The `disaffected-ui/node_modules/` directory contains all frontend dependencies.

* It is generated by running `npm install`
* It can be **hundreds of MBs in size**
* It **should not be committed** to Git
* It **should not be Syncthingâ€™d or backed up**
* If deleted, it can be safely rebuilt with:

  ```bash
  cd disaffected-ui
  npm install
  ```

---

## ğŸ Summary

This system is now capable of managing full rundown reordering logic in an editorial-friendly, web-accessible way. Markdown files remain compatible with Obsidian, and changes are non-destructive to filenames or asset links.

Next: Dockerize the frontend and implement metadata editing + display.

